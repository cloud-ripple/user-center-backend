<a name="EUA18"></a>
# 1 å‡†å¤‡å·¥ä½œ
<a name="RvMBY"></a>
## 1.1 åç«¯é¡¹ç›®åˆå§‹åŒ–
å¼•å…¥ä¾èµ–
```xml
<!--   mybatis     -->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter-test</artifactId>
    <version>2.3.1</version>
    <scope>test</scope>
</dependency>
<!-- mybatis-plus -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.1</version>
</dependency>
```
ymlé…ç½®
```yaml
spring:
  application:
    name: user-center
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: root
    password: twb
    url: jdbc:mysql://localhost:3306/user_center

server:
  port: 8080

# mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™ï¼ˆcamel caseï¼‰æ˜ å°„ï¼Œ
  #å³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMNï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰ åˆ°ç»å…¸ Java å±æ€§å aColumnï¼ˆé©¼å³°å‘½åï¼‰ çš„ç±»ä¼¼æ˜ å°„ã€‚
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: false
```
```sql
create table user
(
    id           bigint auto_increment primary key comment 'ä¸»é”®ID',
    username     varchar(256) default ''                null comment 'ç”¨æˆ·æ˜µç§°',
    userAccount  varchar(256)                           null comment 'è´¦å·',
    avatarUrl    varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    gender       tinyint                                null comment 'æ€§åˆ«',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    phone        varchar(128)                           null comment 'ç”µè¯',
    email        varchar(512)                           null comment 'é‚®ç®±',
    userStatus   int          default 0                 not null comment 'çŠ¶æ€ 0-æ­£å¸¸',
    createTime   datetime     default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    role         int          default 0                 not null comment 'ç”¨æˆ·è§’è‰² 0-æ™®é€šç”¨æˆ· 1-ç®¡ç†å‘˜'
) comment 'ç”¨æˆ·' charset = utf8;
```
<a name="ZaUpe"></a>
## 1.2 æ³¨å†Œæ¥å£

1. ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥è´¦å·å’Œå¯†ç ã€ä»¥åŠæ ¡éªŒ
2. æ ¡éªŒç”¨æˆ·çš„è´¦å·ã€å¯†ç ã€æ ¡éªŒå¯†ç ï¼Œæ˜¯å¦ç¬¦åˆè¦æ±‚
   1. è´¦å·ä¸å°äº4ä½æ•°ï¼Œå¯ä»¥ç™¾åº¦æ ¡éªŒçš„æ­£åˆ™è¡¨è¾¾å¼
   2. å¯†ç ä¸å°äº8ä½
   3. è´¦æˆ·ä¸èƒ½é‡å¤
   4. è´¦æˆ·ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦
   5. å¯†ç å’Œæ ¡éªŒå¯†ç æ˜¯å¦ç›¸åŒ
   6. å…¶å®ƒ
3. å¯¹å¯†ç è¿›è¡ŒåŠ å¯† ï¼ˆå¯†ç åƒä¸‡ä¸èƒ½ç›´æ¥ä»¥æ˜æ–‡å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼‰
4. å‘æ•°æ®åº“ä¸­æ’å…¥ç”¨æˆ·æ•°æ®
```java
public interface UserService extends IService<User> {

    /**
     * ç”¨æˆ·æ³¨å†Œ
     * @param userAccount ç”¨æˆ·è´¦å·
     * @param userPassword ç”¨æˆ·å¯†ç 
     * @param checkPassword æ ¡éªŒå¯†ç 
     * @return æ–°ç”¨æˆ· id
     */
    long userRegister(String userAccount,String userPassword, String checkPassword);
}
```
```java
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User>
        implements UserService {

    @Resource
    private UserMapper userMapper;

    @Override
    public long userRegister(String userAccount, String userPassword, String checkPassword) {
        // 1. æ ¡éªŒ isAnyBlankæ–¹æ³•ç”¨äºæ ¡éªŒå­—ç¬¦ä¸²æ˜¯å¦ä¸º null ã€ç©º
        if (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) {
            return -1; //æœ‰ä¸€é¡¹ä¸æ»¡è¶³æ ¡éªŒå°±è¿”å›-1
        }
        if (userAccount.length() < 4) {
            return -1;
        }
        if (userPassword.length() < 8 || checkPassword.length() < 8) {
            return -1;
        }
        //è´¦æˆ·ä¸èƒ½é‡å¤ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­çš„ç”¨æˆ·
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("userAccount", userAccount);
        long count = userMapper.selectCount(queryWrapper);
        // å¦‚æœè¯¥è´¦æˆ·å·²ç»æœ‰äººæ³¨å†Œäº†
        if (count > 0) {
            return -1;
        }
        //è´¦æˆ·ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦
        // åªå…è®¸å­—æ¯å’Œæ•°å­— // String regEx ="[^a-zA-Z0-9]";
        // æ¸…é™¤æ‰æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦
        String validPattern = "[` ~!@#$%^&*()+=|{}':;',\\\\[\\\\].<>/?~ï¼@#ï¿¥%â€¦â€¦&*ï¼ˆï¼‰â€”â€”+|{}ã€ã€‘â€˜ï¼›ï¼šâ€â€œâ€™ã€‚ï¼Œã€ï¼Ÿ]";
        Matcher matcher = Pattern.compile(validPattern).matcher(userAccount);
        if (matcher.find()) {
            return -1;
        }
        //å¯†ç å’Œæ ¡éªŒå¯†ç ç›¸åŒ
        if (!userPassword.equals(checkPassword)) {
            return -1;
        }

        // 2. åŠ å¯†å¯†ç 
        final String SALT = "bobo"; //æ…å±æ£ï¼Œè®©å¯†ç æ›´åŠ å¤æ‚ çŸ¥é“ç›æ‰èƒ½è§£å¯†ï¼Œé˜²è§£å¯†
        // ä½¿ç”¨Springæä¾›çš„åŠ å¯†å·¥å…·ç±»ï¼Œå¾—åˆ°åŠ å¯†å¯†ç 
        String encryptPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());

        // 3. æ’å…¥ç”¨æˆ·æ•°æ®åˆ°æ•°æ®åº“
        User user = new User();
        user.setUserAccount(userAccount);
        user.setUserPassword(encryptPassword);
        boolean saveResult = this.save(user);
        if (!saveResult) {
            return -1;
        }
        return user.getId();
        //å¦‚æœä¸Šé¢æ²¡æœ‰æ’å…¥æˆåŠŸï¼Œé‚£ä¹ˆç”¨æˆ· ä¸»é”®id ä¸º nullï¼Œæ­¤æ—¶è¿”å› null ï¼Œè€Œ UserService æ¥å£ä¸­çš„æ–¹è¯¥æ³•è¿”å›å€¼æ˜¯ long
        // ä¼šå¯¼è‡´æ•°æ®ç±»å‹ è‡ªåŠ¨æ‹†ç®±å¤±è´¥ï¼ŒæŠ¥é”™
    }
}
```

```java
/**
 * @author boboking
 * @date 2023/11/3
 * @description ç”¨æˆ·æœåŠ¡æµ‹è¯•
 */
@SpringBootTest
public class UserServiceTest {

    @Resource
    private UserService userService;

    @Test
    public void testAddUser() {
        User user = new User();
        user.setUsername("bobo");
        user.setUserAccount("123");
        user.setAvatarUrl("https://c-ssl.duitang.com/uploads/blog/202201/23/20220123222213_2899a.jpeg");
        user.setGender(0);
        user.setUserPassword("123");
        user.setPhone("123456");
        user.setEmail("789");

        boolean result = userService.save(user);
        System.out.println("ç”¨æˆ·idï¼š" + user.getId());
        // æ–­è¨€
        Assertions.assertTrue(result);
    }

    // æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
    @Test
    void userRegister() {
        String userAccount = "ripple";
        String userPassword = "";
        String checkPassword = "123456";
        long result = userService.userRegister(userAccount, userPassword, checkPassword);
        Assertions.assertEquals(-1, result);

        userAccount = "bo"; // æµ‹è¯•è´¦æˆ·é•¿åº¦ä¸å°äº 4 ä½æ•°
        result = userService.userRegister(userAccount, userPassword, checkPassword);
        Assertions.assertEquals(-1, result);

        userAccount = "ripple"; // æµ‹è¯•å¯†ç ä½æ•° ä¸å°äº8
        userPassword = "123456";
        checkPassword = "123456";
        result = userService.userRegister(userAccount, userPassword, checkPassword);
        Assertions.assertEquals(-1, result);

        userAccount = "ripp le"; // æµ‹è¯•ç‰¹æ®Šç©ºæ ¼å­—ç¬¦
        userPassword = "12345678";
        checkPassword = "12345678";
        result = userService.userRegister(userAccount, userPassword, checkPassword);
        Assertions.assertEquals(-1, result);

        userAccount = "ripple"; // æµ‹è¯•å¯†ç å’Œæ ¡éªŒå¯†ç æ˜¯å¦ä¸€è‡´
        userPassword = "12345678";
        checkPassword = "123456789";
        result = userService.userRegister(userAccount, userPassword, checkPassword);
        Assertions.assertEquals(-1, result);

        userAccount = "yupi"; // æµ‹è¯•æ­£å¸¸å¯†ç 
        userPassword = "123456789";
        checkPassword = "123456789";
        result = userService.userRegister(userAccount, userPassword, checkPassword);
        Assertions.assertEquals(-1, result);

    }
}
```
<a name="AdHoH"></a>
## 1.3 ç™»å½•æ¥å£
æ¥æ”¶å‚æ•°ï¼šç”¨æˆ·è´¦æˆ·ã€å¯†ç <br />è¯·æ±‚ç±»å‹ï¼šPOST <br />è¯·æ±‚ä½“ï¼šJSONæ ¼å¼çš„æ•°æ®<br />è¿”å›å€¼ï¼šç”¨æˆ·ä¿¡æ¯ï¼ˆ**è„±æ•**ï¼‰<br />**é€»è¾‘**

1. æ ¡éªŒç”¨æˆ·çš„è´¦å·ã€å¯†ç æ˜¯å¦ç¬¦åˆè¦æ±‚
   1. éç©º
   2. è´¦å·ä¸å°äº4ä½æ•°ï¼Œå¯ä»¥ç™¾åº¦æ ¡éªŒçš„æ­£åˆ™è¡¨è¾¾å¼
   3. å¯†ç ä¸å°äº8ä½
   4. è´¦æˆ·ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦
2. æ ¡éªŒå¯†ç æ˜¯å¦è¾“å…¥æ­£ç¡®ï¼Œè¦å’Œæ•°æ®åº“ä¸­çš„å¯†æ–‡å¯†ç å»å¯¹æ¯”
3. ç”¨æˆ·ä¿¡æ¯**è„±æ•ï¼Œéšè—æ•æ„Ÿä¿¡æ¯**ï¼Œé˜²æ­¢æ•°æ®åº“ä¸­çš„å­—æ®µæ³„éœ²
4. è¦è®°å½•ç”¨æˆ·çš„ç™»é™†çŠ¶æ€ï¼Œå°†å…¶å­˜æ”¾åˆ°æœåŠ¡å™¨ä¸Š(session)
5. è¿”å›è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯

**å¦‚ä½•çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·ç™»å½•äº†ï¼Ÿ**

1. è¿æ¥æœåŠ¡å™¨ç«¯åï¼Œå¾—åˆ°ä¸€ä¸ª session çŠ¶æ€ï¼ˆåŒ¿åä¼šè¯ï¼‰ï¼Œè¿”å›ç»™å‰ç«¯
2. ç™»å½•æˆåŠŸåï¼Œå¾—åˆ°äº†ç™»é™†æˆåŠŸçš„ session ï¼Œå¹¶ä¸”ç»™è¯¥ session è®¾ç½®ä¸€äº›å€¼ï¼ˆæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œè¿”å›ç»™å‰ç«¯ä¸€ä¸ªè®¾ç½® cookie çš„ "å‘½ä»¤"

**session => cookie**

3. å‰ç«¯æ¥æ”¶åˆ°åç«¯çš„å‘½ä»¤åï¼Œè®¾ç½® cookie ï¼Œä¿å­˜åˆ°æµè§ˆå™¨å†…
4. å‰ç«¯å†æ¬¡è¯·æ±‚åç«¯çš„æ—¶å€™(ç›¸åŒçš„åŸŸå)ï¼Œåœ¨è¯·æ±‚å¤´ä¸Šå¸¦ä¸Š cookie å»è¯·æ±‚
5. åç«¯æ‹¿åˆ°å‰ç«¯ä¼ æ¥çš„ cookie ï¼Œæ‰¾åˆ°å¯¹åº”çš„ session
6. åç«¯ä» session ä¸­å¯ä»¥å–å‡ºåŸºäºè¯¥ session å­˜å‚¨çš„å˜é‡ï¼ˆç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€ç™»å½•åç­‰ï¼‰
```java
public interface UserService extends IService<User> {


    /**
     * ç”¨æˆ·æ³¨å†Œ
     *
     * @param userAccount   ç”¨æˆ·è´¦å·
     * @param userPassword  ç”¨æˆ·å¯†ç 
     * @param checkPassword æ ¡éªŒå¯†ç 
     * @return æ–°ç”¨æˆ· id
     */
    long userRegister(String userAccount, String userPassword, String checkPassword);

    /**
     * ç”¨æˆ·ç™»å½•
     *
     * @param userAccount  ç”¨æˆ·è´¦æˆ·
     * @param userPassword ç”¨æˆ·å¯†ç 
     * @param request      è¯·æ±‚
     * @return è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
     */
    User userLogin(String userAccount, String userPassword, HttpServletRequest request);

    /**
     * ç”¨æˆ·ä¿¡æ¯è„±æ•
     *
     * @param user æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„ç”¨æˆ·
     * @return è„±æ•å¤„ç†åçš„ç”¨æˆ·
     */
    User getSafetyUser(User user);
}
```
```java
 @Override
    public User userLogin(String userAccount, String userPassword, HttpServletRequest request) {
        // 1. æ ¡éªŒ isAnyBlankæ–¹æ³•ç”¨äºæ ¡éªŒå­—ç¬¦ä¸²æ˜¯å¦ä¸º null ã€ç©º
        if (StringUtils.isAnyBlank(userAccount, userPassword)) {
            // todo ä¿®æ”¹ä¸ºè‡ªå®šä¹‰å¼‚å¸¸
            return null; //æœ‰ä¸€é¡¹ä¸æ»¡è¶³æ ¡éªŒå°±è¿”å›
        }
        if (userAccount.length() < 4) {
            return null; //
        }
        if (userPassword.length() < 8) {
            return null;
        }

        //è´¦æˆ·ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦
        // String regEx ="[^a-zA-Z0-9]";    // åªå…è®¸å­—æ¯å’Œæ•°å­—
        String validPattern = "[` ~!@#$%^&*()+=|{}':;',\\\\[\\\\].<>/?~ï¼@#ï¿¥%â€¦â€¦&*ï¼ˆï¼‰â€”â€”+|{}ã€ã€‘â€˜ï¼›ï¼šâ€â€œâ€™ã€‚ï¼Œã€ï¼Ÿ]";
        Matcher matcher = Pattern.compile(validPattern).matcher(userAccount);
        if (matcher.find()) { // å¦‚æœå«æœ‰ç‰¹æ®Šå­—ç¬¦
            return null;
        }

        // 2. åŠ å¯†å¯†ç 
        // ä½¿ç”¨Springæä¾›çš„åŠ å¯†å·¥å…·ç±»ï¼Œå¾—åˆ°åŠ å¯†å¯†ç 
        String encryptPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
        // 3. æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("userAccount", userAccount); //ç”¨æˆ·è¾“å…¥çš„è´¦æˆ·è¦ç­‰äºæ•°æ®è¡¨ä¸­çš„å­—æ®µ
        queryWrapper.eq("userPassword", encryptPassword); //ç”¨æˆ·è¾“å…¥çš„å¯†ç è¦ç­‰äºåŠ å¯†åçš„å¯†ç 

        User user = userMapper.selectOne(queryWrapper); //ä»¥ä¸Šä½œä¸ºæ¡ä»¶å»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
        // å¦‚æœç”¨æˆ·ä¸å­˜åœ¨
        if (null == user) {
            log.info("user login failed, userAccount cannot match userPassword"); //match(åŒ¹é…)
            return null;
        }

        // 4. æŠŠè¯¥ç”¨æˆ·ä¿¡æ¯è„±æ•
        User safetyUser = getSafetyUser(user);

        // 5. è®°å½•ç”¨æˆ·çš„ç™»å½•çŠ¶æ€,å°†å…¶å­˜æ”¾åˆ°æœåŠ¡å™¨ä¸Š(session)ï¼Œå½“å‰åªæ˜¯å•ä¸ªï¼Œåé¢å¯ä»¥åšæˆåˆ†å¸ƒå¼
        request.getSession().setAttribute(USER_LOGIN_STATE, safetyUser);

        return safetyUser;
    }
```

<a name="KvYbr"></a>
## 1.4 ç”¨æˆ·ç®¡ç†æ¥å£
ï¼ï¼ï¼æ³¨æ„ï¼šå¿…é¡»è¦é‰´æƒ

1. æŸ¥è¯¢ç”¨æˆ·
   1. å…è®¸æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
2. åˆ é™¤ç”¨æˆ·
```java
@RestController
@RequestMapping("/user")
@Slf4j
public class UserController {

    @Resource
    private UserService userService;

    @PostMapping("/register")
    public Long userRegister(@RequestBody UserRegisterRequest userRegisterRequest) {
        if (userRegisterRequest == null) {
            return null;
        }
        log.info("ç”¨æˆ·æ³¨å†Œè¯·æ±‚å‚æ•°ï¼Œ{}", userRegisterRequest);
        // å‰ç«¯ä¼ é€’è¿‡æ¥çš„æ‰€æœ‰è¯·æ±‚å‚æ•°å°è£…åœ¨ UserRegisterRequest å®ä½“ç±»ä¸­
        String userAccount = userRegisterRequest.getUserAccount();
        String userPassword = userRegisterRequest.getUserPassword();
        String checkPassword = userRegisterRequest.getCheckPassword();
        // ç®€å•æ ¡éªŒï¼Œå¦‚æœè¿™3ä¸ªè¯·æ±‚å‚æ•°æœ‰ä¸€ä¸ªä¸ºç©º
        if (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) {
            return null;
        }
        // è°ƒç”¨æœåŠ¡å±‚æ³¨å†Œæ–¹æ³•
        return userService.userRegister(userAccount, userPassword, checkPassword);
    }

    @PostMapping("/login")
    public User userLogin(@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request) {
        if (userLoginRequest == null) {
            return null;
        }
        log.info("ç”¨æˆ·ç™»å½•è¯·æ±‚å‚æ•°ï¼š{}", userLoginRequest);
        // å‰ç«¯ä¼ é€’è¿‡æ¥çš„ è´¦æˆ·ã€å¯†ç  å‚æ•°å°è£…åœ¨ UserLoginRequest å®ä½“ç±»ä¸­ï¼Œè€ŒHttpè¯·æ±‚å¯¹è±¡å°è£…åœ¨ HttpServletRequest
        String userAccount = userLoginRequest.getUserAccount();
        String userPassword = userLoginRequest.getUserPassword();
        // ç®€å•æ ¡éªŒï¼Œå¦‚æœè¿™2ä¸ªè¯·æ±‚å‚æ•°æœ‰ä¸€ä¸ªä¸ºç©º
        if (StringUtils.isAnyBlank(userAccount, userPassword)) {
            return null;
        }
        return userService.userLogin(userAccount, userPassword, request);
    }

    // æ ¹æ®ç”¨æˆ·åæ¨¡ç³ŠæŸ¥è¯¢
    @GetMapping("/search")
    public List<User> searchUsers(String username, HttpServletRequest request) {
        log.info("æŸ¥è¯¢ç”¨æˆ·å‚æ•° usernameï¼š{}", username);
        // ä»…ç®¡ç†å‘˜å¯æŸ¥è¯¢
        if (!isAdmin(request)) {
            return new ArrayList<>(); //å¦‚æœä¸æ˜¯ç®¡ç†å‘˜è¿”å›ç©ºåˆ—è¡¨
        }
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        // isNotBlank åˆ¤æ–­è¯¥å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ã€ä¸ºç©º
        if (StringUtils.isNotBlank((username))) {
            queryWrapper.like("username", username); //æ¨¡ç³ŠæŸ¥è¯¢
        }

        // æŠŠç”¨æˆ·æ•æ„Ÿä¿¡æ¯è¿‡æ»¤æ‰ï¼Œä¸è¦è¿”å›ç»™å‰ç«¯
        List<User> userList = userService.list(queryWrapper); //ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„ç”¨æˆ·
        List<User> safetyUsersList = new ArrayList<>(); // è„±æ•å¤„ç†åçš„ç”¨æˆ·

        for (User user : userList) {
            safetyUsersList.add(userService.getSafetyUser(user));
        }
        return safetyUsersList;
    }

    // æ ¹æ®idåˆ é™¤ç”¨æˆ·
    @PostMapping("/delete")
    public boolean deleteUser(long id, HttpServletRequest request) {
        log.info("åˆ é™¤ç”¨æˆ·å‚æ•° idï¼š{}", id);
        // ä»…ç®¡ç†å‘˜å¯åˆ é™¤
        if (!isAdmin(request)) {
            return false;
        }
        if (id <= 0) {
            return false;
        }
        return userService.removeById(id);
    }

    /**
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜
     *
     * @param request è¯·æ±‚å¯¹è±¡
     * @return
     */
    private boolean isAdmin(HttpServletRequest request) {
        // ä»…ç®¡ç†å‘˜å¯æŸ¥è¯¢
        User userObj = (User) request.getSession().getAttribute(USER_LOGIN_STATE);
        if (userObj == null || userObj.getUserRole() != ADMIN_ROLE) {
            return false;
        }
        return true;
    }
}

```
<a name="WcB4p"></a>
## 1.5 å‰ç«¯é¡¹ç›®åˆå§‹åŒ–
Ant Design Pro : [https://pro.ant.design/zh-CN/docs/getting-started](https://pro.ant.design/zh-CN/docs/getting-started)<br />æ˜¯åŸºäº Ant Design å’Œ umi çš„å°è£…çš„ä¸€æ•´å¥—ä¼ä¸šçº§ä¸­åå°å‰ç«¯/è®¾è®¡è§£å†³æ–¹æ¡ˆ
<a name="HkmgB"></a>
## 1.6 å°è£…å“åº”ç»“æœç±»-è‡ªå®šä¹‰é”™è¯¯ç æšä¸¾
```java
@Data
public class BaseResponse<T> implements Serializable {

    private int code;

    private T data;

    private String massage;

    private String description;

    public BaseResponse(int code, T data, String massage, String description) {
        this.code = code;
        this.data = data;
        this.massage = massage;
        this.description = description;
    }

    // æˆåŠŸ
    public BaseResponse(int code, T data, String description) {
        this(code, data, "ok", description);
    }

    // å¤±è´¥
    public BaseResponse(ErrorCode errorCode) {
        this(errorCode.getCode(), null, errorCode.getMessage(), errorCode.getDescription());
    }
}

```
```java
public enum ErrorCode {

    PARAMS_ERROR(40000, "è¯·æ±‚å‚æ•°é”™è¯¯", ""),
    NULL_ERROR(40001,"è¯·æ±‚æ•°æ®ä¸ºç©º",""),
    NOT_LOGIN(40100,"æœªç™»å½•",""),
    NO_AUTH(40101,"æ— æƒé™",""),
    SYSTEM_ERROR(50000, "ç³»ç»Ÿå†…éƒ¨å¼‚å¸¸", "");


    /**
     * çŠ¶æ€ç 
     */
    private final int code;

    /**
     * çŠ¶æ€ç ä¿¡æ¯
     */
    private final String message;

    /**
     * è‡ªå®šä¹‰çŠ¶æ€ç æè¿°
     */
    private String description;


    ErrorCode(int code, String message, String description) {
        this.code = code;
        this.message = message;
        this.description = description;
    }

    public int getCode() {
        return code;
    }

    public String getMessage() {
        return message;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }
}


```
```java
public class ResultUtils {
    /**
     * æˆåŠŸ
     * @param data
     * @return
     * @param <T>
     */
    public static <T> BaseResponse<T> success(T data) {
        return new BaseResponse<T>(0, data, "è¯·æ±‚æˆåŠŸ");
    }

    /**
     * å¤±è´¥
     * @param errorCode
     * @return
     */
    public static BaseResponse error(ErrorCode errorCode) {
        return new BaseResponse(errorCode);
    }

    /**
     * å¤±è´¥
     * @param errorCode é”™è¯¯ç 
     * @param description è‡ªå®šä¹‰æè¿°
     * @return
     */
    public static BaseResponse error(ErrorCode errorCode,String description) {
        errorCode.setDescription(description);
        return new BaseResponse(errorCode);
    }
}
```
<a name="f6FEM"></a>
## 1.7 å°è£…å…¨å±€å¼‚å¸¸å¤„ç†

1. è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸

a. ç›¸å¯¹äº java çš„å¼‚å¸¸ç±»ï¼Œå¯ä»¥è‡ªå·±æ‰©å±•å¤šä¸ªå­—æ®µå±æ€§<br />b. è‡ªå®šä¹‰å¤šä¸ªæ„é€ å‡½æ•°

2. å…¨å±€å¼‚å¸¸å¤„ç†å™¨

a. æ•è·ä»£ç ä¸­æ‰€æœ‰çš„å¼‚å¸¸ï¼Œé›†ä¸­å¤„ç†ï¼Œè®©å‰ç«¯å¾—åˆ°æ›´åŠ è¯¦ç»†çš„ä¸šåŠ¡æŠ¥é”™/ä¿¡æ¯
```java
/**
 * @author èŠ±æµ·
 * @date 2023/11/9
 * @description è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸
 */
public class BusinessException extends RuntimeException {

    private final int code;
    private final String description;

    public BusinessException(String message, int code, String description) {
        super(message);
        this.code = code;
        this.description = description;
    }

    public BusinessException(ErrorCode errorCode, String description) {
        super(errorCode.getMessage());
        this.code = errorCode.getCode();
        this.description = description;
    }

    public int getCode() {
        return code;
    }

    public String getDescription() {
        return description;
    }
}

```
```java
/**
 * @author èŠ±æµ·
 * @date 2023/11/9
 * @description å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 */

//@RestControllerAdvice
@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ResponseBody // ä½¿ç”¨ @RestControllerAdvice çš„è¯å¯ä»¥çœç•¥è¯¥æ³¨è§£
    @ExceptionHandler({BusinessException.class})
    public BaseResponse businessExceptionHandler(HttpServletRequest request, BusinessException businessEx) {
        log.error("è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼šçŠ¶æ€ç ={}, ä¿¡æ¯={}, æè¿°={}", businessEx.getCode(), businessEx.getMessage(), businessEx.getDescription());
        return ResultUtils.error(ErrorCode.PARAMS_ERROR, businessEx.getDescription());
    }

    @ResponseBody
    @ExceptionHandler({RuntimeException.class})
    public BaseResponse runtimeExceptionHandler(HttpServletRequest request, RuntimeException e) {
        log.error("è¿è¡Œæ—¶å¼‚å¸¸ï¼š{}", e);
        return ResultUtils.error(ErrorCode.SYSTEM_ERROR);
    }
}

```
<a name="V7K3Y"></a>
# 2 éƒ¨ç½²ä¸Šçº¿
<a name="jhSaa"></a>
## 2.1 å¤šç¯å¢ƒä»¥åŠå‰åç«¯å®æˆ˜é…ç½®
å‚è€ƒæ–‡ç« ï¼š[https://blog.csdn.net/weixin_41701290/article/details/120173283](https://blog.csdn.net/weixin_41701290/article/details/120173283)<br />æœ¬åœ°å¼€å‘ï¼šlocalhost 127.0.0.1<br />å¤šç¯å¢ƒï¼šåŒä¸€å¥—é¡¹ç›®ä»£ç åœ¨ä¸åŒçš„é˜¶æ®µéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥è°ƒæ•´é…ç½®å¹¶éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šã€‚<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699532731361-f76a29b9-10cd-49aa-9295-e60388dda30a.png#averageHue=%23fbf9f8&clientId=uc96e7e2f-f6aa-4&from=paste&height=526&id=u8ba7a444&originHeight=1088&originWidth=1440&originalType=url&ratio=1.6500000953674316&rotation=0&showTitle=false&size=113256&status=done&style=none&taskId=uf8f47476-3c5e-4233-a811-5bd324ddf21&title=&width=696.0037231445312)<br />ä¸ºä»€ä¹ˆéœ€è¦å¤šç¯å¢ƒï¼Ÿ**ï¼ˆé’ˆå¯¹ä¸åŒçš„ç¯å¢ƒåšä¸åŒçš„äº‹æƒ…ï¼‰**ï¼š

1. **æ¯ä¸ªç¯å¢ƒäº’ä¸å½±å“**
2. **ä¸ºäº†åŒºåˆ†ä¸åŒçš„é˜¶æ®µï¼šå¼€å‘/ æµ‹è¯•/ ç”Ÿäº§**
3. **å¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–ï¼š**
   1. æœ¬åœ°æ—¥å¿—çº§åˆ«
   2. ç²¾ç®€ä¾èµ–ï¼ŒèŠ‚çœé¡¹ç›®ä½“ç§¯
   3. é¡¹ç›®çš„ç¯å¢ƒ / å‚æ•°å¯ä»¥è°ƒæ•´
4. **å¤šç¯å¢ƒåˆ†ç±»** ï¼š
   1. æœ¬åœ°ç¯å¢ƒ localhostã€‚
   2. å¼€å‘ç¯å¢ƒ ï¼ˆè¿œç¨‹å¼€å‘ï¼‰å¤§å®¶è¿åŒä¸€å°æœºå™¨ï¼Œå¼€å‘æ–¹ä¾¿ã€‚
   3. æµ‹è¯•ç¯å¢ƒï¼ˆæµ‹è¯•ï¼‰ï¼šç‹¬ç«‹çš„æ•°æ®åº“ã€ç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚
   4. é¢„å‘å¸ƒç¯å¢ƒï¼š**ç±»ä¼¼äºä½“éªŒæœ **,åŸºæœ¬å’Œæ­£å¼ç¯å¢ƒä¸€è‡´ï¼Œæ›´åŠ ä¸¥è°¨ã€æŸ¥å‡ºæ›´å¤šé—®é¢˜ã€‚
   5. æ­£å¼ç¯å¢ƒï¼ˆçº¿ä¸Šã€å¯¹å¤–å¼€æ”¾è®¿é—®çš„é¡¹ç›®ï¼‰ï¼šå°½é‡ä¸è¦æ”¹åŠ¨ï¼Œä¿è¯ä¸Šçº¿çš„ä»£ç æ˜¯â€å®Œç¾çš„â€œã€‚
   6. æ²™ç®±ç¯å¢ƒï¼ˆå®éªŒç¯å¢ƒï¼‰ï¼šä¸ºäº†åšå®éªŒ
5. **å‰ç«¯å¤šç¯å¢ƒå®æˆ˜**

**a. è¯·æ±‚åœ°å€**<br />ğŸ‘‰å¼€å‘ç¯å¢ƒï¼šlocalhost:8000<br />ğŸ‘‰çº¿ä¸Šç¯å¢ƒï¼šhttp://user-center.cn
```javascript
å¦‚ä½•å®ç°ç¯å¢ƒåœ°å€çš„åˆ‡æ¢ï¼Ÿåœ¨é¡¹ç›®å¯åŠ¨ä¹‹å‰
startFront (env) {
	if (env === 'prod) {
      // ä¸è¾“å‡ºæ³¨é‡Š
      // é¡¹ç›®ä¼˜åŒ–
      // ä¿®æ”¹è¯·æ±‚åœ°å€
    } else {
      // ä¿æŒæœ¬åœ°å¼€å‘é€»è¾‘
	}	
}

export const request: RequestConfig = {
  // æ ¹æ®ç¯å¢ƒåŠ¨æ€æ”¹å˜è¯·æ±‚åœ°å€å‰ç¼€
  prefix: process.env.NODE_ENV === 'production'? 'http://user-center.cn' : 'http://localhost:8000/api',
  timeout: 100000,
};
```
**b. å¯åŠ¨æ–¹å¼**<br />å¼€å‘ç¯å¢ƒ**ï¼š**npm run start (æœ¬åœ°å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼Œè‡ªåŠ¨æ›´æ–°)<br />çº¿ä¸Šç¯å¢ƒ**ï¼š**npm sun build ï¼ˆé¡¹ç›®æ‰“åŒ…æ„å»ºï¼‰,è¿›å…¥æ‰€åœ¨èµ„æºç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ serve å·¥å…·å¯åŠ¨ ï¼ˆnpm i 			-g  serve å®‰è£…ï¼‰
```shell
// ä½¿ç”¨ serve å·¥å…·å¯ä»¥åœ¨æœ¬åœ° 3000 ç«¯å£å¼€å¯ä¸€ä¸ªæœåŠ¡å™¨æ¥è®¿é—®é™æ€èµ„æº
npm install serve -g  // å®‰è£… serve

// è¿›å…¥æ‰“åŒ…å¥½çš„ dist ç›®å½•ä¸‹å¯åŠ¨ï¼Œæ‰§è¡Œ serveï¼Œè¿›å…¥ç”Ÿäº§ç¯å¢ƒ
serve
```
**c. é¡¹ç›®çš„é…ç½®**<br />ä¸åŒçš„é¡¹ç›®ï¼ˆæ¡†æ¶ï¼‰éƒ½æœ‰ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶åæ·»åŠ å¯¹åº”çš„ç¯å¢ƒåç§°åç¼€æ¥åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚<br />å¼€å‘ç¯å¢ƒï¼šconfig.dev.ts   ==> devlopment<br />ç”Ÿäº§ç¯å¢ƒï¼šconfig.prod.ts  ==> production<br />å…¬å…±é…ç½®ï¼šconfig.ts  ä¸å¸¦åç¼€

6. **åç«¯å¤šç¯å¢ƒå®æˆ˜**

SpringBoot é¡¹ç›®ï¼Œé€šè¿‡ application.yml æ·»åŠ ä¸åŒçš„åç¼€æ¥åŒºåˆ†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥ç¯å¢ƒå˜é‡æŒ‡å®šé…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚<br />ä¸»è¦æ˜¯ä¿®æ”¹ï¼š<br />a. ä¾èµ–çš„ç¯å¢ƒåœ°å€ï¼šæ•°æ®åº“åœ°å€ã€ç¼“å­˜åœ°å€ã€æ¶ˆæ¯é˜Ÿåˆ—åœ°å€ã€é¡¹ç›®ç«¯å£å·ç­‰ã€‚<br />b. æœåŠ¡å™¨é…ç½®

1. application.yml  è¯¥æ–‡ä»¶åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å…¬å…±é€šç”¨ï¼Œå³é¡¹ç›®éƒ½ä¼šç”¨åˆ°è¯¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰é…ç½®
```yaml
spring:
  application:
    name: user-center
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # æœ¬åœ°æ•°æ®åº“
    username: root
    password: twb
    url: jdbc:mysql://localhost/user_center
  # è®¾ç½®sessionä¼šè¯å¤±æ•ˆæ—¶é—´ ä¸€å¤©
  session:
    timeout: 86400

server:
  port: 8080
  servlet:
    context-path: /api

  # mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™ï¼ˆcamel caseï¼‰æ˜ å°„ï¼Œ
  #å³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMNï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰ åˆ°ç»å…¸ Java å±æ€§å aColumnï¼ˆé©¼å³°å‘½åï¼‰ çš„ç±»ä¼¼æ˜ å°„ã€‚

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: false
  global-config:
    db-config:
      # é€»è¾‘åˆ é™¤é…ç½®  å®˜æ–¹æ–‡æ¡£ï¼šhttps://baomidou.com/pages/6b03c5/#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95
      logic-delete-field: isDelete # å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå(since 3.3.0,é…ç½®åå¯ä»¥å¿½ç•¥ä¸é…ç½®æ­¥éª¤2)
      logic-delete-value: 1 # é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)
      logic-not-delete-value: 0 # é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)
  
```

2. application-prod.ymlï¼šè¯¥æ–‡ä»¶ä¸»è¦æ˜¯é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒçš„é…ç½®
```yaml
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒä¸‹çš„æ•°æ®æº
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æ•°æ®åº“åœ°å€
    username: root
    password: 123456
    url: jdbc:mysql://192.158.200.101:3306/user_center
  # è®¾ç½®sessionä¼šè¯å¤±æ•ˆæ—¶é—´ ä¸€å¤©
  session:
    timeout: 86400

server:
  address: 0.0.0.0

```

3. javaé¡¹ç›®æ‰“åŒ…æ„å»º

åœ¨æ‰“åŒ…ä¹‹å‰å¿…é¡»åˆ é™¤æ‰é¡¹ç›®æ–‡ä»¶ç±»ä¸­æ²¡æœ‰ä½¿ç”¨çš„ä¸€äº›å¯¼åŒ…è¯­å¥ï¼Œå¹¶ä¸”æµ‹è¯•æ–‡ä»¶ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½å‡ºé”™(å› ä¸ºæ‰“åŒ…ä¹‹å‰ä¼šå…ˆè¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥è·³è¿‡æµ‹è¯•ç¯èŠ‚)
```xml
mavenæ‰“åŒ…å‡ºé”™ï¼šé”™è¯¯æç¤ºå¦‚ä¸‹ï¼š
There are test failures.
Please refer to XXX\target\surefire-reports for the individual test results.
Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
é—®é¢˜æè¿°  è¿™æ˜¯å› ä¸ºæµ‹è¯•ä»£ç æ—¶é‡åˆ°é”™è¯¯ï¼Œå®ƒä¼šåœæ­¢ç¼–è¯‘ã€‚

è§£å†³æ–¹æ¡ˆ1ï¼šåœ¨pomæ–‡ä»¶æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œæ‰“åŒ…è·³è¿‡æµ‹è¯•
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
   <artifactId>maven-surefire-plugin</artifactId>
   <configuration>
   <testFailureIgnore>true</testFailureIgnore>
   </configuration>
</plugin>

è§£å†³æ–¹æ¡ˆ2ï¼šé€šè¿‡ideaè®¾ç½®mavenæ‰“åŒ…è·³è¿‡æµ‹è¯•
```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699540518377-36e1033d-12dc-47a0-b02b-d001835e4933.png#averageHue=%233e444a&clientId=uc96e7e2f-f6aa-4&from=paste&height=388&id=u45bcdc0d&originHeight=641&originWidth=947&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&size=66887&status=done&style=none&taskId=u82cd4613-3077-49e7-bd00-586340eea9a&title=&width=573.9393607665922)

4. è¿è¡Œï¼Œè¿›å…¥ target ç›®å½•ä¸‹æ‰¾åˆ°æ‰“åŒ…æ„å»ºçš„ jar åŒ…
```shell
// è¿è¡Œ jar åŒ…ï¼Œå¹¶æŒ‡å®šç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ
java -jar .\user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod

```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699540746246-1733c467-9fdc-4350-91f2-450f84cc5bcc.png#averageHue=%23535041&clientId=uc96e7e2f-f6aa-4&from=paste&height=698&id=u3ac039f4&originHeight=1152&originWidth=2335&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&size=279371&status=done&style=none&taskId=u0daa59b5-98ab-4edf-bec6-47e74a217be&title=&width=1415.151433357965)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699540947126-c9b108cb-5242-4b53-8ab2-1994dd35d019.png#averageHue=%232f2e2e&clientId=uc96e7e2f-f6aa-4&from=paste&height=448&id=u6bd6c7c0&originHeight=740&originWidth=2455&originalType=binary&ratio=1.6500000953674316&rotation=0&showTitle=false&size=179982&status=done&style=none&taskId=u8e8f124a-1810-4ce5-b6fd-9b787ed9520&title=&width=1487.878701881715)

<a name="vRCP4"></a>
## 2.2 é¡¹ç›®éƒ¨ç½²ä¸Šçº¿
<a name="fMb2s"></a>
### åŸå§‹å‰åç«¯é¡¹ç›®æ–¹å¼

1. æŠŠå‰ç«¯æ‰“åŒ…å¥½çš„é¡¹ç›® dist ç›®å½•ä»¥å‹ç¼©åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºç›®å½•ä¸‹ï¼Œè¿›è¡Œè§£å‹
```shell
// è§£å‹åˆ°æŒ‡å®šçš„ç›®å½•
unzip dist.zip -d user-center-frontend

// ä¿®æ”¹ nginx.conf  é…ç½®æ–‡ä»¶
vim /usr/local/nginx-1.20.2/conf/nginx.conf
```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699861486448-f3cef0c7-4875-4462-bff0-0beb5fc5cf2c.png#averageHue=%23131110&clientId=u1739b61f-6a68-4&from=paste&height=507&id=uea302cad&originHeight=761&originWidth=2005&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=194231&status=done&style=none&taskId=u44a2790b-118b-456e-a9eb-3bd0aff2884&title=&width=1336.6666666666667)

2. å¦‚æœéœ€è¦ä¿®æ”¹ nigix é…ç½®ï¼Œåœ¨å®‰è£…ç›®å½• conf ä¸‹æ‰¾åˆ°  nginx.conf  æ–‡ä»¶ï¼Œä¿®æ”¹ä¹‹åéœ€è¦é‡æ–°åŠ è½½ç”Ÿæ•ˆ
```shell
// å¯åŠ¨ nginx æœåŠ¡
nginx

// é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ
nginx -s reload
```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699859714530-f411581b-8ada-4a9d-a648-9e199ab3e88d.png#averageHue=%230c0b0a&clientId=u1f00b01a-fa65-4&from=paste&height=533&id=u4a66b873&originHeight=800&originWidth=1294&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=127067&status=done&style=none&taskId=u6d2cc7f7-b38a-436f-b447-4ef53a03cdf&title=&width=862.6666666666666)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699859899948-704a934b-a65b-4c6b-b94f-f962268967bc.png#averageHue=%23030302&clientId=u1f00b01a-fa65-4&from=paste&height=447&id=u56bb0065&originHeight=670&originWidth=1219&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=64512&status=done&style=none&taskId=u3ac7000a-a2e7-474a-9227-7ca3533371b&title=&width=812.6666666666666)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699860009496-4ef9fad1-bd67-4a10-a276-2616c8c99385.png#averageHue=%23050403&clientId=u1f00b01a-fa65-4&from=paste&height=486&id=u98dbb959&originHeight=729&originWidth=952&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=68978&status=done&style=none&taskId=u56993395-10a6-4e8c-89c2-e9de1b9166e&title=&width=634.6666666666666)

3. è®¿é—®nginxï¼šè™šæ‹ŸæœºIP:80

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699861878148-eda7534a-4c39-4f2f-bcdb-f8616b2b3074.png#averageHue=%23e9eef4&clientId=u19df0cc1-7771-4&from=paste&height=599&id=uc6259431&originHeight=899&originWidth=1644&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=98171&status=done&style=none&taskId=ufaf0601c-6438-40da-b1a9-ba538bf7179&title=&width=1096)

4. éƒ¨ç½²åç«¯é¡¹ç›®ï¼Œé€šè¿‡ maven æ‰“åŒ…æ„å»ºé¡¹ç›®ï¼Œåœ¨IDEA target ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ª jar åŒ…ï¼Œä¸Šä¼ åˆ°è™šæ‹Ÿæœºç›®å½•ä¸‹ï¼ˆä¹Ÿå¯ä»¥åœ¨è™šæ‹Ÿæœºå®‰è£… maven é€šè¿‡ï¼šmvn  package -DskipTests   å‘½ä»¤æ‰“åŒ…ä»è¿œç¨‹ä»“åº“å…‹éš†ä¸‹æ¥çš„çš„é¡¹ç›®ä»£ç ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699862155617-e0e0b30c-710d-4d72-83bf-e77594791e5a.png#averageHue=%2325201f&clientId=u19df0cc1-7771-4&from=paste&height=173&id=u7c315c40&originHeight=260&originWidth=1255&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=47221&status=done&style=none&taskId=u610eaa9a-3baf-4534-ae64-d38a3e52495&title=&width=836.6666666666666)

5. ä½¿ç”¨ java -jar å‘½ä»¤è¿è¡Œ spring boot é¡¹ç›®
```shell
// æ‰“åŒ…æ„å»ºï¼Œè·³è¿‡æµ‹è¯•
mvn  package -DskipTests

// nohup è¡¨ç¤ºä»¥åå°è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œæ³¨æ„æœ«å°¾åŠ  &
// --spring.profiles.active=prod æŒ‡å®š application-prod.yml é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ
nohup java -jar user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod &

// æŸ¥çœ‹æ­£åœ¨åå°è¿è¡Œçš„javaé¡¹ç›®
jobs

// æŸ¥çœ‹è¿›ç¨‹æœåŠ¡
netstat -ntlp

// æŸ¥çœ‹æ‰€æœ‰å·²ç»è¿è¡Œjavaç›¸å…³çš„ç¨‹åº
jps

```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699864177004-66cb38d5-5ff8-40df-af89-044d57c09d2b.png#averageHue=%230c0b0a&clientId=u19df0cc1-7771-4&from=paste&height=500&id=uf1aaae3a&originHeight=750&originWidth=2016&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=134279&status=done&style=none&taskId=uc7c86a53-a7d7-4769-ba6d-380c479d911&title=&width=1344)
<a name="btVKL"></a>
### å®å¡” Linux æ–¹å¼
å®˜ç½‘å®‰è£…ï¼š[https://www.bt.cn/new/download.html](https://www.bt.cn/new/download.html)<br />å®å¡”å‘½ä»¤å¤§å…¨ï¼š[https://www.bt.cn/new/btcode.html](https://www.bt.cn/new/btcode.html)<br />æŸ¥è¯¢æœ¬æœºIP<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699866835043-c78004ed-8d03-4d6a-a806-3f963169b951.png#averageHue=%23fafaf9&clientId=u19df0cc1-7771-4&from=paste&height=480&id=u6628b7a4&originHeight=720&originWidth=1304&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=149368&status=done&style=none&taskId=u38f0228e-2e20-49f1-857f-7e402faaebd&title=&width=869.3333333333334)

1. Linuxå®‰è£…å®å¡”
```shell
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec
```

2. å‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼Œå®‰è£…æˆåŠŸ

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699866979762-9fcac5aa-2ccb-4071-9335-84bd8e6a0cd2.png#averageHue=%230e0e0d&clientId=u19df0cc1-7771-4&from=paste&height=597&id=u6b520a45&originHeight=896&originWidth=1363&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=99864&status=done&style=none&taskId=uf3ad83d9-b981-4942-8772-6769663f908&title=&width=908.6666666666666)

3. ä½¿ç”¨åˆå§‹ç”¨æˆ·åå’Œå¯†ç ç™»å½•

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699867138140-0fa7a3f8-b7e9-4aec-9871-b288cb4a1b94.png#averageHue=%23767676&clientId=u19df0cc1-7771-4&from=paste&height=765&id=u01c3f8ce&originHeight=1148&originWidth=1519&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=101907&status=done&style=none&taskId=u8a52e28e-bc09-4851-b1fa-68e88c36bd8&title=&width=1012.6666666666666)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699867781232-c4b42e57-6adf-4cd1-bd91-3753bf4bc436.png#averageHue=%23fcfbfb&clientId=u19df0cc1-7771-4&from=paste&height=633&id=ua9262506&originHeight=950&originWidth=1522&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=134405&status=done&style=none&taskId=u7051513a-38a3-4872-8a71-6fe9f36c938&title=&width=1014.6666666666666)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699867842312-b222a9ca-afc1-4ed6-b397-08c15b4570c8.png#averageHue=%23fcfaf9&clientId=u19df0cc1-7771-4&from=paste&height=506&id=uf3002a63&originHeight=759&originWidth=1548&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=124446&status=done&style=none&taskId=ue1ec6fda-af06-466d-a3fe-56de1fed3dc&title=&width=1032)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699871370713-631ce3fa-cf2d-4c38-a8c0-5049db9c36f8.png#averageHue=%23100f0f&clientId=u19df0cc1-7771-4&from=paste&height=505&id=u019ca372&originHeight=758&originWidth=1989&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=146425&status=done&style=none&taskId=u8f6c36b8-7ba1-4618-9c09-fc685ad0856&title=&width=1326)

4.  ä¸ºä»€ä¹ˆæˆ‘åœ¨Linuxéƒ¨ç½²çš„SpringbootæœåŠ¡ï¼Œéƒ¨ç½²æˆåŠŸä¹‹åï¼Œä½¿ç”¨netstat -ntlp | grep java å‘½ä»¤æŸ¥çœ‹å¯¹åº”æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œåªçœ‹åˆ°æœ‰tcp6çš„ç›‘å¬ï¼Œæ²¡æœ‰tcpçš„ç›‘å¬ï¼Ÿ

å‚è€ƒæ–‡ç« ï¼š[https://blog.csdn.net/qq_40596572/article/details/131413286?](https://blog.csdn.net/qq_40596572/article/details/131413286?)

5. è®°å¾—æ”¾è¡Œé¡¹ç›®ç«¯å£ï¼Œå¦åˆ™æ— æ³•è®¿é—®ï¼ˆé‡ç‚¹ï¼ï¼ï¼ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699872075521-573aea27-642b-412a-a975-380e4f28ecfd.png#averageHue=%23fbfbfb&clientId=u19df0cc1-7771-4&from=paste&height=551&id=ub4690a25&originHeight=827&originWidth=2162&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=114608&status=done&style=none&taskId=u83502a20-8fc7-45c4-86ff-a5b5542987c&title=&width=1441.3333333333333)
<a name="Qknq3"></a>
### docker å®¹å™¨æ–¹å¼
dockeræ˜¯å®¹å™¨ï¼Œå¯ä»¥æŠŠé¡¹ç›®çš„ç¯å¢ƒï¼ˆæ¯”å¦‚ï¼šjavaã€nginxã€tomcatï¼‰å’Œé¡¹ç›®çš„ä»£ç ä¸€èµ·æ‰“åŒ…æˆé•œåƒï¼Œå¯ä»¥ä¸‹è½½é•œåƒï¼Œæ›´å®¹æ˜“åˆ†å‘å’Œç§»æ¤ï¼Œåœ¨å¯åŠ¨é¡¹ç›®æ—¶ï¼Œä¸ç”¨æ‰§è¡Œä¸€å¤§å †å‘½ä»¤ï¼Œè€Œæ˜¯ç›´æ¥ä¸‹è½½é•œåƒï¼Œå¯åŠ¨é•œåƒå³å¯ã€‚dockerå¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ã€‚<br />Dockerå®˜ç½‘å®‰è£…ï¼š[https://www.docker.com/get-started/](https://www.docker.com/get-started/)   æˆ–è€…åœ¨å®å¡”é‡Œé¢å®‰è£…

1. åœ¨å®å¡”çš„è½¯ä»¶å•†åº—é‡Œå®‰è£…Dockerç®¡ç†å™¨åï¼Œå¯ä»¥åœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šæ‰§è¡Œ   docker -v  æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699872766682-d65d2510-fa11-4029-a042-8d690c6f1bab.png#averageHue=%23f9f9f9&clientId=u19df0cc1-7771-4&from=paste&height=343&id=u9177efb2&originHeight=514&originWidth=1336&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=49494&status=done&style=none&taskId=u3efe243a-bd45-4c7c-9448-d46e5136818&title=&width=890.6666666666666)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699872674843-06d9cfc8-ded9-4d89-bc11-14d3a81f9117.png#averageHue=%23353433&clientId=u19df0cc1-7771-4&from=paste&height=165&id=u679638f2&originHeight=247&originWidth=1086&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=27266&status=done&style=none&taskId=u62645b70-fcbc-4ba4-8b0d-fc4b8831289&title=&width=724)

2. æ€ä¹ˆæŠŠé¡¹ç›®çš„ç¯å¢ƒå’Œä»£ç æ‰“åŒ…æˆé•œåƒï¼Ÿ----> Dockerfile  ç”¨äºæŒ‡å®šæ„å»º Dockeré•œåƒ

Dockerfile ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ä»0å¼€å§‹å†™ï¼Œå»ºè®®å‚è€ƒç½‘ä¸ŠåŒç±»åˆ«é¡¹ç›®ï¼Œå¦‚ä¸‹é…ç½®ï¼š<br />Dockerfileåç«¯ï¼š
```shell
# ä¾èµ–çš„åŸºç¡€é•œåƒ
FROM maven:3.5-jdk-8-alpine as builder

# Copy local code to the container image.
# å·¥ä½œç›®å½•
WORKDIR /app
COPY pom.xml .
COPY src ./src

# Build a release artifact.
# æ‰“åŒ…æ„å»ºï¼Œè·³è¿‡æµ‹è¯•
RUN mvn package -DskipTests

# Run the web service on container startup.
# å¯åŠ¨è¿è¡Œé•œåƒçš„æ—¶å€™ï¼Œé»˜è®¤æ‰§è¡Œè¯¥å‘½ä»¤(åœ¨å¯åŠ¨æ—¶å¯ä»¥æŒ‡å®šæˆ–ä¿®æ”¹å‘½ä»¤å‚æ•°)
CMD ["java","-jar","/app/target/user-center-backend-0.0.1-SNAPSHOT.jar","--spring.profiles.active=prod"]
```

Dockerfileå‰ç«¯ï¼š
```shell
FROM nginx

WORKDIR /usr/share/nginx/html/
USER root

COPY ./docker/nginx.conf /etc/nginx/conf.d/default.conf

COPY ./dist  /usr/share/nginx/html/

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]

```
å‰ç«¯Docker nginx é…ç½®ï¼š
```shell
server {
    listen 80;

    # gzip config
    gzip on;
    gzip_min_length 1k;
    gzip_comp_level 9;
    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;
    gzip_vary on;
    gzip_disable "MSIE [1-6]\.";

    root /usr/share/nginx/html;
    include /etc/nginx/mime.types;

    location / {
        try_files $uri /index.html;
    }

}
```

3. Docker æ‰“åŒ…é•œåƒ

Dockerèœé¸Ÿæ•™ç¨‹ï¼š[https://www.runoob.com/docker/docker-build-command.html](https://www.runoob.com/docker/docker-build-command.html)
```shell
å®ä¾‹
ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º runoob/ubuntu:v1ã€‚
docker build -t runoob/ubuntu:v1 . 

ä½¿ç”¨URL github.com/creack/docker-firefox çš„ Dockerfile åˆ›å»ºé•œåƒã€‚
docker build github.com/creack/docker-firefox

ä¹Ÿå¯ä»¥é€šè¿‡ -f Dockerfile æŒ‡å®šæ–‡ä»¶çš„ä½ç½®ï¼š
docker build -f /path/to/a/Dockerfile .


ä½¿ç”¨ docker images æ¥åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ
docker images

åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œ Dockerfile ä¸­çš„æŒ‡ä»¤å‰ï¼Œé¦–å…ˆä¼šå¯¹ Dockerfile è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œæœ‰è¯­æ³•é”™è¯¯æ—¶ä¼šè¿”å›ï¼š
docker build -t test/myapp .
Sending build context to Docker daemon 2.048 kB
Error response from daemon: Unknown instruction: RUNCMD
```
æ³¨æ„ï¼š**åœ¨ä½¿ç”¨dockerfileæ‰“åŒ…é•œåƒçš„æ—¶å€™ï¼Œå»ºè®®æŠŠé¡¹ç›®ä»£ç å…‹éš†git clone æˆ–è€…ä¸Šä¼ åˆ°Linux è™šæ‹Ÿæœºç›®å½•ä¸‹ï¼Œå¹¶åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œdockerçš„æ‰“åŒ…å‘½ä»¤ï¼Œä¿è¯æœ‰ Dockerfile æ–‡ä»¶**
```shell
# åç«¯ æ‰“åŒ…é•œåƒ
docker build -t user-center-backend:v0.0.1 . 

# å‰ç«¯ æ‰“åŒ…é•œåƒ
docker build -t user-center-frontend:v0.0.1 . 

# åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šå·²ç»æ„å»ºå‡ºæ¥çš„çš„é•œåƒ
docker images
```
![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699878404188-c7f527b2-4244-4fcf-84cb-816b8caaeb7e.png#averageHue=%230b0b0a&clientId=u19df0cc1-7771-4&from=paste&height=335&id=u5c75a69f&originHeight=503&originWidth=2167&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=94996&status=done&style=none&taskId=u7d56d789-82b6-4e7e-8e9b-abf0b9554ba&title=&width=1444.6666666666667)

4. Docker æ„å»ºä¼˜åŒ–ï¼šå‡å°‘å°ºå¯¸å¤§å°ã€å‡å°‘æ„å»ºæ—¶é—´ï¼ˆæ¯”å¦‚å¤šé˜¶æ®µæ„å»ºï¼Œä¸¢å¼ƒä¸éœ€è¦çš„æ­¥éª¤å†…å®¹ï¼‰
5. å¯åŠ¨è¿è¡ŒDocker é•œåƒ 
```shell
// å¯åŠ¨é•œåƒ
docker run
```
<a name="uFFJN"></a>
### å®¹å™¨å¹³å°æ–¹å¼
.......
<a name="s0kSr"></a>
## 2.3 ä½¿ç”¨å®å¡”Linuxéƒ¨ç½²é¡¹ç›®è¸©å‘é—®é¢˜-å®¹æ˜“å‡ºé”™çš„ç›¸å…³é…ç½®
nginx è·¨åŸŸé…ç½®ä»£ç†ï¼š
```shell
location /api {
      proxy_pass http://127.0.0.1:8080;  
      add_header 'Access-Control-Allow-Origin' $http_origin;
      add_header 'Access-Control-Allow-Credentials' 'true';
      add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
      add_header Access-Control-Allow-Headers '*';
      if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' $http_origin;
        add_header 'Access-Control-Allow-Credentials' 'true';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers'
        'DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
      }
    }
```
mysql æœåŠ¡å¯åŠ¨æŠ¥é”™é—®é¢˜ 1ï¼š Starting MySQL. ERROR! The server quit without updating PID file (/usr/local/mysql/mysql.pid) <br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699948499464-0c3663c3-0d4e-47ff-b34a-bccc0f0824cc.png#averageHue=%230d0b0a&clientId=u17d81284-4398-4&from=paste&height=341&id=HsqzS&originHeight=511&originWidth=1785&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=147465&status=done&style=none&taskId=u657a2bcf-03f1-4f66-94b7-1fb73ca086c&title=&width=1190)<br />mysql å®¢æˆ·ç«¯é¦–æ¬¡ç™»å½•æŠ¥é”™ 2ï¼šCan't connect to local MySQL server through socket '/tmp/mysql.sock'<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699951613518-06b9c436-c9e9-4cde-b751-d822825ddbbb.png#averageHue=%230a0908&clientId=u17d81284-4398-4&from=paste&height=210&id=QSoCZ&originHeight=315&originWidth=1861&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=96465&status=done&style=none&taskId=u951a9449-edf3-498b-b9e4-f9eeb6e2c73&title=&width=1240.6666666666667)<br />mysql è‡ªå®šä¹‰ my.cnf  é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699951876366-6c6e7cf8-6aaf-437c-bcd3-f567d54dc31b.png#averageHue=%23050404&clientId=u17d81284-4398-4&from=paste&height=120&id=xjywP&originHeight=180&originWidth=1675&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=29468&status=done&style=none&taskId=uca925305-0251-433c-b0f0-d1340166fa4&title=&width=1116.6666666666667)
```shell
[client]
#å®¢æˆ·ç«¯è®¾ç½®
port=3306
default-character-set=utf8
socket=/var/lib/mysql/mysql.sock
[mysqld]
port=3306
#ä¸ºMySQLå®¢æˆ·ç«¯ç¨‹åºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æœ¬åœ°é€šè®¯æŒ‡å®šä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶
socket=/var/lib/mysql/mysql.sock
#ç«¯å£ç»‘å®šçš„ipåœ°å€ï¼Œ0.0.0.0è¡¨ç¤ºå…è®¸æ‰€æœ‰è¿œç¨‹è®¿é—®ï¼Œ127.0.0.1è¡¨ç¤ºåªèƒ½æœ¬æœºè®¿é—®ï¼Œé»˜è®¤å€¼ä¸º*
bind-address=0.0.0.0
#é»˜è®¤åä¸º ä¸»æœºå.pid,åœ¨æ•°æ®åº“/mysql/data/ä¸»æœºå.pid,è®°å½•mysqlè¿è¡Œçš„process id
#å¦‚æœå­˜åœ¨ï¼Œå†æ¬¡startæ—¶ä¼šæŠ¥å·²ç»å¯åŠ¨
pid-file=/usr/local/mysql/mysql.pid
#å®‰è£…ç›®å½•
basedir=/usr/local/mysql
#æ•°æ®åº“å­˜æ”¾ç›®å½•
datadir=/usr/local/mysql/data
#ç³»ç»Ÿæ•°æ®åº“ç¼–ç è®¾ç½®ï¼Œæ’åºè§„åˆ™
character_set_server=utf8
lower_case_table_names=1
max_connections=512
##é”™è¯¯æ—¥å¿—ï¼šè®°å½•å¯åŠ¨ï¼Œè¿è¡Œï¼Œåœæ­¢mysqlæ—¶å‡ºç°çš„ä¿¡æ¯
log-error=/data/mysql/logs/error.log
#é»˜è®¤ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“
default_storage_engine=INNODB

```
<a name="iZxm3"></a>
## 2.4 å‰åç«¯å…³é”®é…ç½®æ–‡ä»¶-è¯·æ±‚è”è°ƒ-è·¨åŸŸé—®é¢˜
å‰ç«¯é¡¹ç›®ä»£ç†é…ç½®ï¼š
```typescript
export default {
  dev: {
    //å‰ç«¯è¯·æ±‚çš„ url ===> http://localhost:8000/api/
    //åç«¯é¡¹ç›®çš„ url ===> http://localhost:8080/api/
    
    '/api': {
      // è¦ä»£ç†çš„åœ°å€
      target: 'http://localhost:8080',
      // é…ç½®äº†è¿™ä¸ªå¯ä»¥ä» http ä»£ç†åˆ° https
      // ä¾èµ– origin çš„åŠŸèƒ½å¯èƒ½éœ€è¦è¿™ä¸ªï¼Œæ¯”å¦‚ cookie
      changeOrigin: true,
    },
  },
  // test: {
  //   '/api/': {
  //     target: 'https://proapi.azurewebsites.net',
  //     changeOrigin: true,
  //     pathRewrite: { '^': '' },
  //   },
  // },
  // pre: {
  //   '/api/': {
  //     target: 'your pre url',
  //     changeOrigin: true,
  //     pathRewrite: { '^': '' },
  //   },
  // },
};
```
å‰ç«¯é¡¹ç›®è¯·æ±‚å‰ç¼€é…ç½®ï¼š
```typescript
export const request: RequestConfig = {
  //å‰ç«¯è¯·æ±‚çš„ url ===> http://localhost:8000/api/
  //åç«¯é¡¹ç›®çš„ url ===> http://localhost:8080/api/
  
  prefix: '/api',
  // prefix: process.env.NODE_ENV === 'production'? 'http://user-center.cn' : '/api',
  timeout: 100000,
};
```
åç«¯é¡¹ç›®é…ç½®ï¼š
```yaml
spring:
  application:
    name: user-center
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # æœ¬åœ°æ•°æ®åº“
    username: root
    password: twb
    url: jdbc:mysql://localhost/user_center
  # è®¾ç½®sessionä¼šè¯å¤±æ•ˆæ—¶é—´ ä¸€å¤©
  session:
    timeout: 86400

server:
  port: 8080
  servlet:
  # //åç«¯é¡¹ç›®çš„ url ===> http://localhost:8080/api/
    context-path: /api

# mapUnderscoreToCamelCase æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™ï¼ˆcamel caseï¼‰æ˜ å°„ï¼Œ
#å³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMNï¼ˆä¸‹åˆ’çº¿å‘½åï¼‰ åˆ°ç»å…¸ Java å±æ€§å aColumnï¼ˆé©¼å³°å‘½åï¼‰ çš„ç±»ä¼¼æ˜ å°„ã€‚
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: false
  global-config:
    db-config:
      # é€»è¾‘åˆ é™¤é…ç½®  å®˜æ–¹æ–‡æ¡£ï¼šhttps://baomidou.com/pages/6b03c5/#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95
      logic-delete-field: isDelete # å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå(since 3.3.0,é…ç½®åå¯ä»¥å¿½ç•¥ä¸é…ç½®æ­¥éª¤2)
      logic-delete-value: 1 # é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)
      logic-not-delete-value: 0 # é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)
```
```yaml
# ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆLinux è™šæ‹ŸæœºæœåŠ¡å™¨ï¼‰
spring:
  # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒä¸‹çš„æ•°æ®æº
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ˆLinux è™šæ‹ŸæœºæœåŠ¡å™¨IPï¼‰çš„æ•°æ®åº“åœ°å€
    username: root
    password: 123456
    url: jdbc:mysql://192.158.200.101:3306/user_center
  # è®¾ç½®sessionä¼šè¯å¤±æ•ˆæ—¶é—´ ä¸€å¤©
  session:
    timeout: 86400

server:
  address: 0.0.0.0
```

nginx ä»£ç†é…ç½®ã€è·¨åŸŸé—®é¢˜ï¼š<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699952304116-f185ddd5-fff6-4471-a445-34eb46f18799.png#averageHue=%23d1d1d0&clientId=u17d81284-4398-4&from=paste&height=909&id=udb4103d4&originHeight=1364&originWidth=2417&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=421105&status=done&style=none&taskId=uea08b414-c329-405f-b254-66437737d4a&title=&width=1611.3333333333333)
```shell
location /api {
  proxy_pass http://127.0.0.1:8080;  
  add_header 'Access-Control-Allow-Origin' $http_origin;
  add_header 'Access-Control-Allow-Credentials' 'true';
  add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
  add_header Access-Control-Allow-Headers '*';
  if ($request_method = 'OPTIONS') {
    add_header 'Access-Control-Allow-Origin' $http_origin;
    add_header 'Access-Control-Allow-Credentials' 'true';
    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    add_header 'Access-Control-Allow-Headers'
    'DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    add_header 'Access-Control-Max-Age' 1728000;
    add_header 'Content-Type' 'text/plain; charset=utf-8';
    add_header 'Content-Length' 0;
    return 204;
  }
}
```
<a name="RW1Q8"></a>
## 2.5 å‰åç«¯åˆ†ç¦»é¡¹ç›®éƒ¨ç½²æµç¨‹
<a name="tPjpo"></a>
### 2.5.1 å‰ç«¯éƒ¨ç½²

1. æŠŠå‰ç«¯é¡¹ç›®æ‰“åŒ…æ„å»ºå¥½çš„  dist  ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ åˆ° Linux è™šæ‹ŸæœºæœåŠ¡å™¨çš„æŸä¸ªç›®å½•ä¸‹ï¼Œåœ¨é…ç½® nginx.conf  æ–‡ä»¶æ—¶ï¼Œä¿è¯å‡†ç¡®å®šä½å¹¶æŒ‡æ˜ nginx è®¿é—®çš„æ ¹ç›®å½• /root è·¯å¾„   è®©distç›®å½•ä¸‹çš„æ–‡ä»¶æ­£å¸¸è®¿é—®

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699954298822-707f76dd-f3c8-4694-a0ea-7db7528c476a.png#averageHue=%23141211&clientId=u17d81284-4398-4&from=paste&height=484&id=u92482113&originHeight=726&originWidth=1916&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=196410&status=done&style=none&taskId=u2bf00a66-ea51-4160-80b1-996746470c1&title=&width=1277.3333333333333)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699954517926-a3bf6c2a-52a3-4d2c-99a2-bc3c2fc15377.png#averageHue=%23121110&clientId=u17d81284-4398-4&from=paste&height=250&id=u5d679da9&originHeight=375&originWidth=1855&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=82291&status=done&style=none&taskId=u70679c6a-ea6b-4446-9079-793be99c525&title=&width=1236.6666666666667)<br />nginx å…³é”®é…ç½®ï¼š<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699955042915-d7c0c03c-2946-40a7-a74b-911946ade2f1.png#averageHue=%23020202&clientId=u17d81284-4398-4&from=paste&height=442&id=ua3a5bd6f&originHeight=663&originWidth=1003&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=57104&status=done&style=none&taskId=ube60b721-573d-42aa-a1c7-079b0106385&title=&width=668.6666666666666)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699954971451-a74b5072-574b-46f3-968a-65180ab69066.png#averageHue=%23030302&clientId=u17d81284-4398-4&from=paste&height=508&id=u720ac055&originHeight=762&originWidth=1175&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=131379&status=done&style=none&taskId=u0b01ace2-0205-4e6f-9744-b26382d87ed&title=&width=783.3333333333334)

2. ä½¿ç”¨å®å¡”Linuxéƒ¨ç½²å‰ç«¯é¡¹ç›®

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699955487077-4fdf7ad0-7ff1-438d-b4d7-2a10d11c6ca3.png#averageHue=%23988056&clientId=u17d81284-4398-4&from=paste&height=795&id=u187941f0&originHeight=1193&originWidth=1495&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=220135&status=done&style=none&taskId=u4b574547-c685-4a68-ac8e-3b72736ad5d&title=&width=996.6666666666666)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699955586680-e38826ff-be08-4a61-838b-093720162535.png#averageHue=%23d4d4d3&clientId=u17d81284-4398-4&from=paste&height=613&id=u8f7ff895&originHeight=920&originWidth=1552&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=159870&status=done&style=none&taskId=u7aa8a50d-154a-4bab-a1bf-6ed5185a55b&title=&width=1034.6666666666667)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699955889368-27c2fa75-5e02-4145-8271-c37914cd300e.png#averageHue=%23d0d0d0&clientId=u17d81284-4398-4&from=paste&height=779&id=u3d7fad38&originHeight=1168&originWidth=2082&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=297590&status=done&style=none&taskId=u7cbeb3ce-9e8f-4e6a-909c-bba8f97d0f2&title=&width=1388)<br />æ·»åŠ çš„é…ç½®ä»£ç†å¦‚ä¸‹ï¼š
```shell
location /api {
      proxy_pass http://127.0.0.1:8080;  
      add_header 'Access-Control-Allow-Origin' $http_origin;
      add_header 'Access-Control-Allow-Credentials' 'true';
      add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
      add_header Access-Control-Allow-Headers '*';
      if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' $http_origin;
        add_header 'Access-Control-Allow-Credentials' 'true';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers'
        'DNT,web-token,app-token,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
      }
    }
```
<a name="GxVUl"></a>
### 2.5.2 åç«¯éƒ¨ç½²

1. æŠŠåç«¯é¡¹ç›®æ‰“åŒ…æ„å»ºå¥½çš„  jar  åŒ…ï¼ˆIDEAä½¿ç”¨mavenæ‰“åŒ…å¹¶è·³è¿‡æµ‹è¯•ï¼Œåœ¨ targetç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª jar åŒ…ï¼‰ä¸Šä¼ åˆ° Linux è™šæ‹Ÿæœºä¸­æˆ–è€…é€šè¿‡å®å¡”ä¸Šä¼ ï¼Œä½¿ç”¨ java  -jar å‘½ä»¤è¿è¡Œå¯åŠ¨é¡¹ç›®ã€‚
```shell
1. mavenæ‰“åŒ…å‡ºé”™ï¼šé”™è¯¯æç¤ºå¦‚ä¸‹ï¼š
There are test failures.
Please refer to XXX\target\surefire-reports for the individual test results.
Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
é—®é¢˜æè¿°  è¿™æ˜¯å› ä¸ºæµ‹è¯•ä»£ç æ—¶é‡åˆ°é”™è¯¯ï¼Œå®ƒä¼šåœæ­¢ç¼–è¯‘ã€‚

è§£å†³æ–¹æ¡ˆ1ï¼šåœ¨pomæ–‡ä»¶æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œæ‰“åŒ…è·³è¿‡æµ‹è¯•
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
   <artifactId>maven-surefire-plugin</artifactId>
   <configuration>
   <testFailureIgnore>true</testFailureIgnore>
   </configuration>
</plugin>

è§£å†³æ–¹æ¡ˆ2ï¼šé€šè¿‡ideaè®¾ç½®mavenæ‰“åŒ…è·³è¿‡æµ‹è¯•


2. åŸå§‹åç«¯é¡¹ç›®å¯åŠ¨å‘½ä»¤ï¼Œä»¥éƒ¨ç½²åœ¨Linuxè™šæ‹Ÿæœºä¸Šä¸ºä¾‹
// æ‰“åŒ…æ„å»ºï¼Œè·³è¿‡æµ‹è¯•ï¼ˆæ‰§è¡Œè¯¥å‘½ä»¤éœ€è¦å®‰è£… Mavenï¼‰
mvn  package -DskipTests

// nohup è¡¨ç¤ºä»¥åå°è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œæ³¨æ„æœ«å°¾åŠ  &
// --spring.profiles.active=prod æŒ‡å®š application-prod.yml é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ
nohup java -jar user-center-backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod &

// æŸ¥çœ‹æ­£åœ¨åå°è¿è¡Œçš„javaé¡¹ç›®
jobs

// æŸ¥çœ‹è¿›ç¨‹æœåŠ¡
netstat -ntlp

// æŸ¥çœ‹æ‰€æœ‰å·²ç»è¿è¡Œjavaç›¸å…³çš„ç¨‹åº
jps
```

2. ä½¿ç”¨å®å¡”Linuxéƒ¨ç½²åç«¯javaé¡¹ç›®ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/35352732/1699956709272-341cb607-3d83-48e3-915b-60014825b718.png#averageHue=%23dadada&clientId=u17d81284-4398-4&from=paste&height=768&id=udddbe18e&originHeight=1152&originWidth=1508&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=200302&status=done&style=none&taskId=uc1cec0c0-e178-454d-b31b-e65016fa57b&title=&width=1005.3333333333334)
